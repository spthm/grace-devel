# DO NOT EDIT THIS FILE.
# Instead, copy Makefile.config.example to Makefile.config, and modify that.

# This file may be included from multiple locations, but this file may also
# specify locations relative to itself.
THIS_PATH = $(dir $(lastword $(MAKEFILE_LIST)))

# E.g. make's 'include' is NOT relative to the current file, it is relative to
# the Makefile with which make was called.
include $(THIS_PATH)Makefile.config

# abspath does not require files to exist.
# We must use absolute paths because these dependencies will be used by
# Makefiles in multiple locations.
GRACE_DIR := $(abspath $(THIS_PATH)/../)
GRACE_INC_DIR := $(abspath $(GRACE_DIR)/include/)

# This is required only for segmented_scan.cu's printf formatting; it is not
# required by GRACE.
SGPU_DIR := $(abspath $(GRACE_DIR)/include/grace/external/sgpu/)

# We could do some of this on a Makefile-by-Makefile basis instead to save
# re-compiling everything when only a few headers are changed, but that is
# extremely error prone.
NVCCDEPS = Makefile
NVCCDEPS += $(abspath $(THIS_PATH)Makefile.common)
NVCCDEPS += $(abspath $(THIS_PATH)Makefile.config)

NVCCDEPS += $(abspath $(wildcard $(GRACE_INC_DIR)/grace/cuda/device/*.cuh))
NVCCDEPS += $(abspath $(wildcard $(GRACE_INC_DIR)/grace/cuda/kernels/*.cuh))
NVCCDEPS += $(abspath $(wildcard $(GRACE_INC_DIR)/grace/cuda/util/*.cuh))
NVCCDEPS += $(abspath $(wildcard $(GRACE_INC_DIR)/grace/cuda/*.cuh))
NVCCDEPS += $(abspath $(wildcard $(GRACE_INC_DIR)/grace/cuda/*.h))
NVCCDEPS += $(abspath $(wildcard $(GRACE_INC_DIR)/grace/cuda/*.hpp))

NVCCDEPS += $(abspath $(wildcard $(GRACE_INC_DIR)/grace/generic/util/*.h))
NVCCDEPS += $(abspath $(wildcard $(GRACE_INC_DIR)/grace/generic/util/*.hpp))
NVCCDEPS += $(abspath $(wildcard $(GRACE_INC_DIR)/grace/generic/*.h))
NVCCDEPS += $(abspath $(wildcard $(GRACE_INC_DIR)/grace/generic/*.hpp))

NVCCDEPS += $(abspath $(wildcard $(THIS_PATH)/helper/*.cuh))
NVCCDEPS += $(abspath $(wildcard $(THIS_PATH)/helper/*.h))
NVCCDEPS += $(abspath $(wildcard $(THIS_PATH)/helper/*.hpp))

NVCCINCLUDES = -I$(GRACE_INC_DIR) -I$(GRACE_DIR)/tests/ -I$(SGPU_DIR)

NVCCFLAGS = $(CUARCH) $(GRACE_FLAGS)
ifdef USE_OPENMP
ifeq ($(USE_OPENMP), 1)
NVCCFLAGS += -Xcompiler -fopenmp
endif
endif

ifdef GRACE_DEBUG
ifeq ($(GRACE_DEBUG), 1)
NVCCFLAGS += -DGRACE_DEBUG -DTHRUST_DEBUG -g -lineinfo
endif
endif

NVCCLFLAGS += $(CUDA_LIB)

NVCCLIBS = -lcuda -lcurand
