# DO NOT EDIT THIS FILE.
# Instead, copy Makefile.config.example to Makefile.config, and modify that.

UNIT_TEST_DIRS = AABB \
	aligned_allocator \
	aligned_malloc \
	morton_key \
	morton_key_kernel \
	Vector3 \
	Vector4 \
	vector3_math \
	vector4_math

INTEGRATION_TEST_DIRS = segmented_scan \
    bvh_consistency \
	distance_sort \
	integrate \
	integrate_gadget \
	isotropic_ray_stats \
	sphere_intersection \
	tree_traversal

DUMP_DIRS = project_gadget render_triangle hitcounts

PROFILE_DIRS = AABB_intersect \
	benchmark_rngs \
	profile_one_to_many_rays_gadget \
	profile_project_gadget \
	profile_trace_gadget \
	profile_trace_triangle \
	profile_tree \
	profile_tree_gadget \
	profile_tree_triangle

# The variables here _must_ be simply expanded, as they are later altered.
ALL_DIRS := $(UNIT_TEST_DIRS) $(INTEGRATION_TEST_DIRS) $(DUMP_DIRS) $(PROFILE_DIRS)

# They will be marked as phony, but we better make sure the targets
# don't correspond to any actual files/directories, either.
# So we'll prefix them all.
UNIT_TEST_DIRS := $(UNIT_TEST_DIRS:%=unit-%)
INTEGRATION_TEST_DIRS := $(INTEGRATION_TEST_DIRS:%=integration-%)
DUMP_DIRS := $(DUMP_DIRS:%=dump-%)
PROFILE_DIRS := $(PROFILE_DIRS:%=profile-%)
CLEAN_DIRS := $(ALL_DIRS:%=clean-%)
DISTCLEAN_DIRS := $(ALL_DIRS:%=distclean-%)

all: unit integration dump profile

unit: $(UNIT_TEST_DIRS)
$(UNIT_TEST_DIRS):
	$(MAKE) -C $(@:unit-%=%)

integration: $(INTEGRATION_TEST_DIRS)
$(INTEGRATION_TEST_DIRS):
	$(MAKE) -C $(@:integration-%=%)

dump: $(DUMP_DIRS)
$(DUMP_DIRS):
	$(MAKE) -C $(@:dump-%=%)

profile: $(PROFILE_DIRS)
$(PROFILE_DIRS):
	$(MAKE) -C $(@:profile-%=%)


clean: $(CLEAN_DIRS)
$(CLEAN_DIRS):
	@-rm -f *.o
	@$(MAKE) --no-print-directory -C $(@:clean-%=%) clean

distclean: clean $(DISTCLEAN_DIRS)
$(DISTCLEAN_DIRS):
	@$(MAKE) --no-print-directory -C $(@:distclean-%=%) distclean

.PHONY: all unit integration dump profile clean distclean
.PHONY: $(UNIT_TEST_DIRS)
.PHONY: $(INTEGRATION_TEST_DIRS)
.PHONY: $(DUMP_DIRS)
.PHONY: $(PROFILE_DIRS)
.PHONY: $(CLEAN_DIRS)
.PHONY: $(DISTCLEAN_DIRS)
